<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dark Online Store</title>
<style>
  body {
    margin:0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #121212; color: #eee;
    display: flex; flex-direction: column; min-height: 100vh;
  }
  header, footer {
    background: #1e1e1e; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center;
  }
  h1, h2, h3 {
    margin: 0;
  }
  button {
    cursor: pointer;
    border: none;
    border-radius: 5px;
    padding: 8px 14px;
    font-weight: 600;
    background-color: #007bff;
    color: #eee;
    transition: background-color 0.3s ease;
  }
  button:hover:not(:disabled) {
    background-color: #0056b3;
  }
  button:disabled {
    background-color: #555;
    cursor: default;
  }
  main {
    flex: 1;
    padding: 20px;
    max-width: 960px;
    margin: auto;
    width: 100%;
  }
  .nav-btn {
    background: #444;
  }
  input, textarea {
    width: 100%;
    padding: 8px 10px;
    margin-bottom: 12px;
    border-radius: 6px;
    border: none;
    font-size: 16px;
    background: #222;
    color: #eee;
  }
  label {
    font-weight: 600;
    margin-bottom: 4px;
    display: block;
  }
  .product-list, .order-list {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(280px,1fr));
    gap: 20px;
  }
  .product-card, .order-card {
    background: #222;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 0 8px #00000080;
    display: flex;
    flex-direction: column;
  }
  .product-card img, .order-card img {
    max-width: 100%;
    border-radius: 8px;
    margin-bottom: 10px;
    object-fit: contain;
    max-height: 160px;
  }
  .qty-controls {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .qty-btn {
    background: #444;
    font-weight: bold;
    font-size: 18px;
    padding: 4px 10px;
  }
  form {
    max-width: 400px;
    margin-bottom: 30px;
  }
  .error {
    color: #ff6666;
    margin-bottom: 12px;
  }
  @media (max-width: 600px) {
    .product-list, .order-list {
      grid-template-columns: 1fr;
    }
    header, footer {
      flex-direction: column;
      gap: 10px;
    }
  }
</style>
</head>
<body>
<header>
  <h1>My Dark Store</h1>
  <button id="loginToggleBtn" class="nav-btn">Admin Login</button>
</header>
<main id="app"></main>
<footer>
  <small>© 2025 My Dark Store</small>
</footer>

<!-- React & ReactDOM from CDN -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

<script>
  const { useState, useEffect, useRef } = React;

  const ADMIN_USERNAME = "Admin";
  const ADMIN_PASSWORD = "Ha676543";

  // LocalStorage helpers
  function loadData(key, defaultValue) {
    try {
      const raw = localStorage.getItem(key);
      if (!raw) return defaultValue;
      return JSON.parse(raw);
    } catch {
      return defaultValue;
    }
  }
  function saveData(key, data) {
    localStorage.setItem(key, JSON.stringify(data));
  }

  // Convert file input to base64 string
  function fileToBase64(file) {
    return new Promise((res, rej) => {
      const reader = new FileReader();
      reader.onload = () => res(reader.result);
      reader.onerror = () => rej("Error reading file");
      reader.readAsDataURL(file);
    });
  }

  function App() {
    const [isAdmin, setIsAdmin] = useState(false);
    const [showLogin, setShowLogin] = useState(false);
    const [loginError, setLoginError] = useState("");

    // Products and orders stored in localStorage
    const [products, setProducts] = useState(() => loadData("products", []));
    const [orders, setOrders] = useState(() => loadData("orders", []));

    // Sync data to localStorage
    useEffect(() => {
      saveData("products", products);
    }, [products]);
    useEffect(() => {
      saveData("orders", orders);
    }, [orders]);

    // Generate unique ID for products/orders
    const generateId = () => Math.floor(Math.random() * 1_000_000);

    // Admin login handler
    function handleLogin(e) {
      e.preventDefault();
      const username = e.target.username.value.trim();
      const password = e.target.password.value.trim();
      if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
        setIsAdmin(true);
        setShowLogin(false);
        setLoginError("");
      } else {
        setLoginError("Invalid credentials");
      }
    }
    function handleLogout() {
      setIsAdmin(false);
    }

    // Product Management - Admin
    function addProduct() {
      const newProduct = {
        id: generateId(),
        name: "",
        description: "",
        price: 0,
        image: null, // base64 image string
      };
      setProducts((p) => [newProduct, ...p]);
    }
    function updateProduct(id, field, value) {
      setProducts((p) =>
        p.map((prod) => (prod.id === id ? { ...prod, [field]: value } : prod))
      );
    }
    function removeProduct(id) {
      if (!window.confirm("Are you sure you want to delete this product?")) return;
      setProducts((p) => p.filter((prod) => prod.id !== id));
      // Also remove from orders if any (optional)
    }

    // Orders handling
    function placeOrder(name, cart) {
      if (!name.trim()) {
        alert("Please enter your name.");
        return false;
      }
      if (Object.keys(cart).length === 0) {
        alert("Please select at least one product.");
        return false;
      }
      const newOrder = {
        id: generateId(),
        name: name.trim(),
        items: cart, // { productId: qty }
        fulfilled: false,
        fulfillmentPhoto: null,
      };
      setOrders((o) => [newOrder, ...o]);
      alert("Order placed! You will meet in person for payment.");
      return true;
    }

    function fulfillOrder(orderId, photoBase64) {
      setOrders((o) =>
        o.map((order) =>
          order.id === orderId
            ? { ...order, fulfilled: true, fulfillmentPhoto: photoBase64 }
            : order
        )
      );
      // Show browser notification
      if (Notification.permission === "granted") {
        new Notification("Order Fulfilled", {
          body: `Order #${orderId} fulfilled successfully!`,
        });
      }
    }

    // Request notification permission on mount if admin
    useEffect(() => {
      if (isAdmin && Notification.permission !== "granted") {
        Notification.requestPermission();
      }
    }, [isAdmin]);

    // Toggle login modal button text
    useEffect(() => {
      const btn = document.getElementById("loginToggleBtn");
      btn.textContent = isAdmin ? "Admin Dashboard" : "Admin Login";
      btn.onclick = () => {
        if (isAdmin) setShowLogin(false);
        else setShowLogin((v) => !v);
      };
    }, [isAdmin]);

    // --------------------
    // Components below
    // --------------------

    // Storefront component for customers to place orders
    function Storefront() {
      const [cart, setCart] = useState({}); // productId -> quantity
      const [customerName, setCustomerName] = useState("");

      function addToCart(pid) {
        setCart((c) => ({ ...c, [pid]: (c[pid] || 0) + 1 }));
      }
      function removeFromCart(pid) {
        setCart((c) => {
          if (!c[pid]) return c;
          const updated = { ...c };
          if (updated[pid] === 1) delete updated[pid];
          else updated[pid]--;
          return updated;
        });
      }
      function handleSubmit(e) {
        e.preventDefault();
        if (placeOrder(customerName, cart)) {
          setCart({});
          setCustomerName("");
        }
      }

      return (
        React.createElement("section", {},
          React.createElement("h2", {}, "Place Your Order"),
          React.createElement("form", { onSubmit: handleSubmit },
            React.createElement("label", { htmlFor: "name" }, "Your Name"),
            React.createElement("input", {
              id: "name",
              type: "text",
              value: customerName,
              onChange: (e) => setCustomerName(e.target.value),
              placeholder: "Enter your name",
              required: true,
            }),
            products.length === 0 && React.createElement("p", {}, "No products available."),

            React.createElement("div", { className: "product-list" },
              products.map((p) =>
                React.createElement("div", { key: p.id, className: "product-card" },
                  p.image && React.createElement("img", { src: p.image, alt: p.name }),
                  React.createElement("h3", {}, p.name || "(No name)"),
                  React.createElement("p", {}, p.description || "(No description)"),
                  React.createElement("p", { style: { fontWeight: "bold" } }, `$${Number(p.price).toFixed(2)}`),
                  React.createElement("div", { className: "qty-controls" },
                    React.createElement("button", {
                      type: "button",
                      className: "qty-btn",
                      onClick: () => removeFromCart(p.id),
                      disabled: !(cart[p.id] > 0),
                      "aria-label": `Remove one ${p.name} from cart`
                    }, "−"),
                    React.createElement("span", {}, cart[p.id] || 0),
                    React.createElement("button", {
                      type: "button",
                      className: "qty-btn",
                      onClick: () => addToCart(p.id),
                      "aria-label": `Add one ${p.name} to cart`
                    }, "+"),
                  )
                )
              )
            ),
            React.createElement("button", { type: "submit" }, "Place Order")
          )
        )
      );
    }

    // Admin product editor card
    function ProductEditor({ product }) {
      const fileInputRef = useRef(null);

      async function onImageChange(e) {
        const file = e.target.files[0];
        if (!file) return;
        if (!file.type.startsWith("image/")) {
          alert("Please upload an image file.");
          return;
        }
        const base64 = await fileToBase64(file);
        updateProduct(product.id, "image", base64);
      }
      return (
        React.createElement("div", { className: "product-card" },
          product.image && React.createElement("img", { src: product.image, alt: product.name }),
          React.createElement("label", {}, "Product Name"),
          React.createElement("input", {
            type: "text",
            value: product.name,
            onChange: (e) => updateProduct(product.id, "name", e.target.value),
            placeholder: "Product name",
          }),
          React.createElement("label", {}, "Description"),
          React.createElement("textarea", {
            value: product.description,
            onChange: (e) => updateProduct(product.id, "description", e.target.value),
            rows: 3,
            placeholder: "Product description",
          }),
          React.createElement("label", {}, "Price ($)"),
          React.createElement("input", {
            type: "number",
            min: "0",
            step: "0.01",
            value: product.price,
            onChange: (e) => updateProduct(product.id, "price", e.target.value),
          }),
          React.createElement("label", {}, "Image"),
          React.createElement("input", {
            type: "file",
            accept: "image/*",
            onChange: onImageChange,
            ref: fileInputRef,
          }),
          React.createElement("button", {
            type: "button",
            onClick: () => removeProduct(product.id),
            style: { backgroundColor: "#cc3333", marginTop: "10px" }
          }, "Remove Product")
        )
      );
    }

    // Admin orders management
    function AdminOrders() {
      const [photoUploads, setPhotoUploads] = useState({}); // orderId -> base64 photo

      async function onPhotoChange(e, orderId) {
        const file = e.target.files[0];
        if (!file) return;
        if (!file.type.startsWith("image/")) {
          alert("Please upload an image file.");
          return;
        }
        const base64 = await fileToBase64(file);
        setPhotoUploads((p) => ({ ...p, [orderId]: base64 }));
      }

      function handleFulfill(order) {
        const photo = photoUploads[order.id] || order.fulfillmentPhoto;
        if (!photo) {
          alert("Please upload a photo of the product before fulfilling.");
          return;
        }
        fulfillOrder(order.id, photo);
        setPhotoUploads((p) => {
          const copy = { ...p };
          delete copy[order.id];
          return copy;
        });
      }

      if (orders.length === 0) {
        return React.createElement("p", {}, "No orders yet.");
      }

      return React.createElement("section", {},
        React.createElement("h2", {}, "Orders"),
        React.createElement("div", { className: "order-list" },
          orders.map((order) => {
            return React.createElement("div", { key: order.id, className: "order-card" },
              React.createElement("p", {}, React.createElement("strong", {}, "Order ID: "), order.id),
              React.createElement("p", {}, React.createElement("strong", {}, "Name: "), order.name),
              React.createElement("p", {}, React.createElement("strong", {}, "Items:")),
              React.createElement("ul", {},
                Object.entries(order.items).map(([pid, qty]) => {
                  const prod = products.find(p => p.id === +pid);
                  return React.createElement("li", { key: pid }, `${prod ? prod.name : "(Deleted product)"} — Quantity: ${qty}`);
                })
              ),
              React.createElement("label", {}, "Upload fulfillment photo:"),
              React.createElement("input", {
                type: "file",
                accept: "image/*",
                onChange: (e) => onPhotoChange(e, order.id),
                disabled: order.fulfilled,
              }),
              (photoUploads[order.id] || order.fulfillmentPhoto) && React.createElement("img", {
                src: photoUploads[order.id] || order.fulfillmentPhoto,
                alt: "Fulfillment photo",
                style: { maxWidth: "100%", borderRadius: "8px", marginTop: "8px" }
              }),
              React.createElement("button", {
                type: "button",
                disabled: order.fulfilled,
                onClick: () => handleFulfill(order),
                style: { marginTop: "10px" }
              }, order.fulfilled ? "Fulfilled ✓" : "Mark Fulfilled")
            );
          })
        )
      );
    }

    // Admin dashboard
    function AdminDashboard() {
      return React.createElement("section", {},
        React.createElement("h2", {}, "Admin Dashboard"),
        React.createElement("button", { onClick: addProduct, style: { marginBottom: "15px" } }, "Add New Product"),
        products.length === 0 && React.createElement("p", {}, "No products yet."),
        React.createElement("div", { className: "product-list" },
          products.map((p) => React.createElement(ProductEditor, { key: p.id, product: p }))
        ),
        React.createElement(AdminOrders)
      );
    }

    // Login modal
    function LoginModal() {
      if (!showLogin) return null;
      return React.createElement("div", {
        style: {
          position: "fixed",
          inset: 0,
          backgroundColor: "rgba(0,0,0,0.8)",
          display: "flex",
          justifyContent: "center",
          alignItems: "center",
          zIndex: 1000,
        }
      },
        React.createElement("form", {
          onSubmit: handleLogin,
          style: {
            backgroundColor: "#222",
            padding: "25px",
            borderRadius: "12px",
            width: "320px",
            boxShadow: "0 0 15px #000"
          }
        },
          React.createElement("h2", { style: { marginBottom: "15px", textAlign: "center" } }, "Admin Login"),
          loginError && React.createElement("div", { className: "error" }, loginError),
          React.createElement("label", { htmlFor: "username" }, "Username"),
          React.createElement("input", { id: "username", name: "username", autoComplete: "username", required: true, autoFocus: true }),
          React.createElement("label", { htmlFor: "password" }, "Password"),
          React.createElement("input", { id: "password", name: "password", type: "password", autoComplete: "current-password", required: true }),
          React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginTop: "20px" } },
            React.createElement("button", { type: "submit" }, "Login"),
            React.createElement("button", {
              type: "button",
              onClick: () => setShowLogin(false)
            }, "Cancel")
          )
        )
      );
    }

    return React.createElement(React.Fragment, {},
      React.createElement(LoginModal),
      React.createElement("main", {},
        isAdmin
          ? React.createElement(React.Fragment, {},
              React.createElement("button", { onClick: handleLogout, style: { marginBottom: "20px" } }, "Logout Admin"),
              React.createElement(AdminDashboard)
            )
          : React.createElement(Storefront)
      )
    );
  }

  ReactDOM.createRoot(document.getElementById("app")).render(React.createElement(App));
</script>
</body>
</html>
