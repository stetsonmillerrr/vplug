<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>ðŸ’¨ Vape Plug</title>
<style>
  /* --- Reset & base --- */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #0e0f17; color: #ddd;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  a, button {
    cursor: pointer;
  }
  input, select, button, textarea {
    border-radius: 12px;
    border: none;
    padding: 12px 14px;
    margin: 6px 0;
    font-size: 1rem;
    outline-offset: 2px;
    transition: outline-color 0.3s ease;
    background: #1c1d28;
    color: #ddd;
    width: 100%;
  }
  input:focus, select:focus, textarea:focus, button:focus {
    outline: 2px solid #6e56f3;
    background: #25273f;
  }
  button {
    background: linear-gradient(135deg, #5a46f5, #2b28b7);
    color: white;
    font-weight: 600;
    border-radius: 18px;
    box-shadow: 0 4px 10px rgb(90 70 245 / 0.6);
    transition: background 0.4s ease, box-shadow 0.4s ease;
  }
  button:hover:not(:disabled) {
    background: linear-gradient(135deg, #2b28b7, #5a46f5);
    box-shadow: 0 6px 15px rgb(90 70 245 / 0.8);
  }
  button:disabled {
    opacity: 0.5; cursor: not-allowed;
  }
  h1,h2,h3 {
    margin: 0.2em 0 0.6em 0;
    font-weight: 700;
    user-select:none;
  }
  ul {
    padding-left: 18px;
  }
  /* --- Container --- */
  #app {
    flex-grow: 1;
    max-width: 420px;
    margin: 0 auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
  }
  /* --- Rounded containers --- */
  .card {
    background: #171822;
    border-radius: 20px;
    padding: 20px;
    margin: 12px 0;
    box-shadow:
      inset 0 0 5px #3a3d6f,
      0 0 10px rgb(90 70 245 / 0.4);
    border: 2px solid transparent;
    position: relative;
    overflow: hidden;
  }
  .card::before {
    content: "";
    position: absolute;
    top: -50%; left: -50%;
    width: 200%; height: 200%;
    background: linear-gradient(45deg, #5a46f5, #5537d8, #3f65f5, #7745ff);
    animation: rotateGrad 8s linear infinite;
    filter: blur(20px);
    opacity: 0.35;
    z-index: 0;
    border-radius: 30px;
  }
  .card > * {
    position: relative;
    z-index: 1;
  }
  @keyframes rotateGrad {
    0% { transform: rotate(0deg);}
    100% { transform: rotate(360deg);}
  }
  /* --- Header --- */
  header {
    position: sticky;
    top: 0;
    background: #141522cc;
    backdrop-filter: saturate(180%) blur(12px);
    padding: 12px 20px;
    border-radius: 0 0 16px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    user-select:none;
    z-index: 100;
  }
  #toggleNavBtn {
    background: none;
    border: none;
    color: #9f9fff;
    font-size: 1.5rem;
    cursor: pointer;
    border-radius: 12px;
    padding: 6px 12px;
    transition: background 0.3s ease;
  }
  #toggleNavBtn:hover {
    background: #5a46f533;
  }
  nav#navMenu {
    position: fixed;
    top: 56px; left: 0; right: 0;
    background: #141522cc;
    backdrop-filter: saturate(200%) blur(14px);
    border-radius: 0 0 20px 20px;
    padding: 14px 24px;
    display: none;
    flex-direction: column;
    gap: 12px;
    user-select:none;
  }
  nav#navMenu.active {
    display: flex;
  }
  nav#navMenu button {
    font-size: 1.1rem;
    color: #c0c0ff;
    background: transparent;
    box-shadow: none;
    padding: 8px 12px;
    text-align: left;
    border-radius: 12px;
  }
  nav#navMenu button:hover {
    background: #5a46f544;
  }
  /* --- Main content --- */
  main {
    flex-grow: 1;
    margin-top: 12px;
  }
  /* --- Form groups --- */
  .form-group {
    margin-bottom: 14px;
    display: flex;
    flex-direction: column;
  }
  label {
    margin-bottom: 4px;
    font-weight: 600;
    font-size: 0.9rem;
    color: #aaaaff;
  }
  /* --- Cart --- */
  #cartList {
    list-style: none;
    padding: 0;
    margin: 0 0 10px 0;
  }
  #cartList li {
    background: #1c1d28;
    margin-bottom: 10px;
    padding: 12px 16px;
    border-radius: 18px;
    box-shadow: inset 0 0 7px #3a3d6f;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  #cartList li .item-name {
    font-weight: 700;
    color: #b2b2ff;
    flex-grow: 1;
  }
  #cartList li .qty-controls {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  #cartList li button {
    padding: 6px 12px;
    font-size: 1rem;
    background: linear-gradient(135deg, #6a59f8, #352eaa);
  }
  /* --- Stars for rating --- */
  .stars {
    display: flex;
    align-items: center;
    gap: 6px;
    user-select:none;
  }
  .star {
    font-size: 1.8rem;
    color: #444;
    cursor: pointer;
    transition: color 0.3s ease;
  }
  .star.selected, .star.hovered {
    color: #6e56f3;
    text-shadow: 0 0 6px #6e56f3;
  }
  .star.readonly {
    cursor: default;
  }
  /* --- Reviews --- */
  #reviewsList {
    max-height: 200px;
    overflow-y: auto;
  }
  .review {
    background: #222338;
    margin-bottom: 10px;
    border-radius: 18px;
    padding: 12px 16px;
    box-shadow: inset 0 0 10px #3a3d6f;
  }
  .review-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 700;
    color: #aabbee;
  }
  .review-user {
    font-style: italic;
    letter-spacing: 1.5px;
  }
  .review-text {
    margin: 6px 0 0 0;
    color: #ccc;
    white-space: pre-wrap;
  }
  .remove-review-btn {
    background: transparent;
    border: none;
    color: #ff6666;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    border-radius: 12px;
    transition: color 0.3s ease;
  }
  .remove-review-btn:hover {
    color: #ff0000;
  }
  /* --- Login modal --- */
  #loginModal {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(14,15,23,0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }
  #loginModal.hidden {
    display: none;
  }
  #loginModal .modal-content {
    background: #171822;
    border-radius: 20px;
    padding: 28px 36px;
    max-width: 320px;
    width: 90vw;
    box-shadow: 0 0 20px #6e56f3aa;
  }
  #loginModal h2 {
    color: #a6a6ff;
    margin-bottom: 20px;
    user-select:none;
  }
  #loginModal input {
    width: 100%;
  }
  #loginModal button {
    margin-top: 18px;
    width: 100%;
  }
  #loginError {
    margin-top: 10px;
    color: #ff6666;
    font-weight: 700;
    display: none;
    user-select:none;
  }
  /* --- Notifications / Toast --- */
  #toast {
    position: fixed;
    bottom: 20px; left: 50%;
    transform: translateX(-50%);
    background: #5a46f5cc;
    padding: 12px 20px;
    border-radius: 30px;
    color: #fff;
    font-weight: 600;
    box-shadow: 0 0 20px #5a46f5cc;
    opacity: 0;
    pointer-events: none;
    user-select:none;
    transition: opacity 0.4s ease;
    z-index: 10000;
  }
  #toast.show {
    opacity: 1;
    pointer-events: auto;
  }
  /* --- Image container --- */
  #vapeImage {
    max-width: 120px;
    border-radius: 20px;
    box-shadow: 0 0 20px #6e56f3cc inset;
    margin: 8px auto 12px;
    display: block;
  }
  /* --- Order Status --- */
  #orderStatusContainer {
    margin-top: 14px;
  }
  #orderStatusPhoto {
    max-width: 180px;
    border-radius: 20px;
    margin-top: 10px;
    display: block;
    box-shadow: 0 0 18px #6e56f3cc inset;
  }
  /* --- Other text --- */
  .small-text {
    font-size: 0.85rem;
    color: #8888cc;
    user-select:none;
    margin-top: 6px;
  }
  /* --- Smooth animations --- */
  .fadeIn {
    animation: fadeIn 0.8s ease forwards;
  }
  @keyframes fadeIn {
    from {opacity:0;}
    to {opacity:1;}
  }
</style>
</head>
<body>
<header>
  <div style="font-size:1.6rem; font-weight:700; color:#a6a6ff; user-select:none;">ðŸ’¨ Vape Plug</div>
  <button id="toggleNavBtn" aria-label="Toggle Navigation Menu" aria-expanded="false">â˜°</button>
</header>
<nav id="navMenu" aria-label="Main navigation">
  <button data-target="shopSection">Shop</button>
  <button data-target="cartSection">Cart</button>
  <button data-target="reviewSection">Reviews</button>
  <button data-target="meetupSection">Meetup</button>
  <button id="adminPanelBtn">Admin</button>
</nav>

<main id="app" role="main" aria-live="polite" aria-atomic="true">
  <!-- SHOP -->
  <section id="shopSection" class="card fadeIn" aria-label="Shop Section">
    <h2>Choose Your Vape</h2>
    <img id="vapeImage" src="https://mipod.com/cdn/shop/files/Raz_Tn9000_Blue-Razz-Ice-A1_600x600_301ec6b8-7092-48b0-a835-d79222491c25.png?v=1700249533" alt="Raz Blue Razz Vape" />
    <div class="form-group">
      <label for="brandSelect">Brand</label>
      <select id="brandSelect" aria-describedby="brandHelp">
        <option value="raz">Raz</option>
      </select>
      <small id="brandHelp" class="small-text">Only one brand available.</small>
    </div>
    <div class="form-group">
      <label for="flavorSelect">Flavor</label>
      <select id="flavorSelect" aria-describedby="flavorHelp">
        <option value="blueRazz">Blue Raz</option>
      </select>
      <small id="flavorHelp" class="small-text">Only one flavor available.</small>
    </div>
    <div class="form-group">
      <label for="priceDisplay">Estimated Price</label>
      <input id="priceDisplay" type="text" readonly aria-readonly="true" />
    </div>
    <button id="addToCartBtn" aria-label="Add selected vape to cart">Add to Cart</button>
  </section>

  <!-- CART -->
  <section id="cartSection" class="card fadeIn" aria-label="Shopping Cart" hidden>
    <h2>Your Cart</h2>
    <ul id="cartList" aria-live="polite" aria-atomic="true"></ul>
    <div class="form-group">
      <label for="buyerName">Your Name</label>
      <input id="buyerName" type="text" placeholder="Enter your name" aria-required="true" />
    </div>
    <div class="form-group">
      <label for="meetupLocation">Meetup Location</label>
      <input id="meetupLocation" type="text" placeholder="Where to meet?" aria-required="true" />
    </div>
    <div class="form-group">
      <label for="scheduledDate">Preferred Meetup Date</label>
      <input id="scheduledDate" type="date" />
    </div>
    <button id="placeOrderBtn" aria-label="Place your order">Place Order</button>
    <div id="orderStatusContainer" hidden>
      <strong>Order Status:</strong>
      <div id="orderStatusText" style="margin-top:6px;"></div>
      <img id="orderStatusPhoto" alt="Order status photo" hidden />
    </div>
  </section>

  <!-- REVIEWS -->
  <section id="reviewSection" class="card fadeIn" aria-label="Reviews Section" hidden>
    <h2>Reviews & Ratings</h2>
    <form id="reviewForm" aria-describedby="reviewDesc">
      <div class="form-group">
        <label for="reviewerName">Your Name (first letter only will show)</label>
        <input id="reviewerName" type="text" placeholder="Your name or nickname" aria-required="true" maxlength="20" />
      </div>
      <div class="form-group">
        <label>Rate Service Quality</label>
        <div id="serviceStars" class="stars" role="radiogroup" aria-label="Service quality rating">
          <span tabindex="0" role="radio" aria-checked="false" class="star" data-value="1" aria-label="1 star">â˜…</span>
          <span tabindex="-1" role="radio" aria-checked="false" class="star" data-value="2" aria-label="2 stars">â˜…</span>
          <span tabindex="-1" role="radio" aria-checked="false" class="star" data-value="3" aria-label="3 stars">â˜…</span>
          <span tabindex="-1" role="radio" aria-checked="false" class="star" data-value="4" aria-label="4 stars">â˜…</span>
          <span tabindex="-1" role="radio" aria-checked="false" class="star" data-value="5" aria-label="5 stars">â˜…</span>
        </div>
      </div>
      <div class="form-group">
        <label for="reviewText">Your Review</label>
        <textarea id="reviewText" rows="4" placeholder="Write your review here..." aria-required="true"></textarea>
      </div>
      <button id="submitReviewBtn" type="submit" aria-label="Submit your review">Submit Review</button>
    </form>
    <h3>All Reviews</h3>
    <div id="reviewsList" role="list" aria-live="polite" aria-atomic="true"></div>
  </section>

  <!-- MEETUP FEEDBACK -->
  <section id="meetupSection" class="card fadeIn" aria-label="Meetup Section" hidden>
    <h2>Meetup Date Requests & Feedback</h2>
    <div id="meetupRequests" role="list" aria-live="polite"></div>
    <form id="meetupFeedbackForm" aria-describedby="meetupDesc" style="margin-top:20px;">
      <div class="form-group">
        <label for="meetupNameInput">Your Name</label>
        <input id="meetupNameInput" type="text" placeholder="Name" aria-required="true" />
      </div>
      <div class="form-group">
        <label for="meetupResponseInput">Are you available on selected meetup date?</label>
        <select id="meetupResponseInput" aria-required="true">
          <option value="">-- Select --</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
          <option value="maybe">Maybe</option>
        </select>
      </div>
      <button id="submitMeetupFeedback" type="submit">Send Feedback</button>
    </form>
  </section>

  <!-- ADMIN DASHBOARD -->
  <section id="adminDashboard" class="card fadeIn" aria-label="Admin Dashboard" hidden>
    <h2>Admin Dashboard</h2>
    <button id="logoutAdminBtn" style="margin-bottom: 12px;">Logout</button>
    <h3>Orders (Pending / Fulfilled)</h3>
    <div id="adminOrdersList" role="list" style="max-height: 220px; overflow-y: auto;"></div>
    <h3>Profit</h3>
    <div id="profitDisplay" style="font-weight:700; font-size:1.2rem; color:#a6a6ff; margin-bottom: 16px;">$0</div>
    <h3>Reviews Management</h3>
    <div id="adminReviewsList" role="list" style="max-height: 200px; overflow-y: auto;"></div>
  </section>
</main>

<!-- LOGIN MODAL -->
<div id="loginModal" role="dialog" aria-modal="true" aria-labelledby="loginTitle" class="hidden">
  <div class="modal-content">
    <h2 id="loginTitle">Admin Login</h2>
    <input id="adminUsername" type="text" placeholder="Username" aria-label="Admin username" />
    <input id="adminPassword" type="password" placeholder="Password" aria-label="Admin password" />
    <button id="loginBtn">Login</button>
    <div id="loginError" role="alert">Invalid credentials!</div>
  </div>
</div>

<!-- Toast Notification -->
<div id="toast" role="alert" aria-live="assertive" aria-atomic="true"></div>

<script>
(() => {
  // Constants and initial data
  const BRAND = "Raz";
  const FLAVOR = "Blue Raz";
  const PRICE_BASE = 40; // $40 base per vape unit
  const TAX_PER_UNIT = 5; // $5 tax per vape
  const ADMIN_USERNAME = "Admin";
  const ADMIN_PASSWORD = "Ha676543";

  // Elements refs
  const navBtn = document.getElementById('toggleNavBtn');
  const navMenu = document.getElementById('navMenu');
  const shopSection = document.getElementById('shopSection');
  const cartSection = document.getElementById('cartSection');
  const reviewSection = document.getElementById('reviewSection');
  const meetupSection = document.getElementById('meetupSection');
  const adminDashboard = document.getElementById('adminDashboard');
  const adminPanelBtn = document.getElementById('adminPanelBtn');

  const priceDisplay = document.getElementById('priceDisplay');
  const addToCartBtn = document.getElementById('addToCartBtn');

  const cartList = document.getElementById('cartList');
  const buyerNameInput = document.getElementById('buyerName');
  const meetupLocationInput = document.getElementById('meetupLocation');
  const scheduledDateInput = document.getElementById('scheduledDate');
  const placeOrderBtn = document.getElementById('placeOrderBtn');

  const reviewForm = document.getElementById('reviewForm');
  const reviewerNameInput = document.getElementById('reviewerName');
  const reviewTextInput = document.getElementById('reviewText');
  const serviceStarsContainer = document.getElementById('serviceStars');
  const reviewsList = document.getElementById('reviewsList');

  const meetupRequestsDiv = document.getElementById('meetupRequests');
  const meetupFeedbackForm = document.getElementById('meetupFeedbackForm');
  const meetupNameInput = document.getElementById('meetupNameInput');
  const meetupResponseInput = document.getElementById('meetupResponseInput');
  const submitMeetupFeedbackBtn = document.getElementById('submitMeetupFeedback');

  const loginModal = document.getElementById('loginModal');
  const loginBtn = document.getElementById('loginBtn');
  const adminUsernameInput = document.getElementById('adminUsername');
  const adminPasswordInput = document.getElementById('adminPassword');
  const loginError = document.getElementById('loginError');

  const adminOrdersList = document.getElementById('adminOrdersList');
  const profitDisplay = document.getElementById('profitDisplay');
  const adminReviewsList = document.getElementById('adminReviewsList');
  const logoutAdminBtn = document.getElementById('logoutAdminBtn');

  const orderStatusContainer = document.getElementById('orderStatusContainer');
  const orderStatusText = document.getElementById('orderStatusText');
  const orderStatusPhoto = document.getElementById('orderStatusPhoto');

  // State variables
  let cart = [];
  let orders = JSON.parse(localStorage.getItem('orders')) || [];
  let reviews = JSON.parse(localStorage.getItem('reviews')) || [];
  let meetupFeedbacks = JSON.parse(localStorage.getItem('meetupFeedbacks')) || [];
  let loggedIn = false;

  // Accessibility helpers for stars rating
  let currentRating = 0;

  // Toggle nav menu
  navBtn.addEventListener('click', () => {
    const expanded = navBtn.getAttribute('aria-expanded') === 'true';
    navBtn.setAttribute('aria-expanded', !expanded);
    navMenu.classList.toggle('active');
  });

  // Nav menu buttons scroll
  navMenu.querySelectorAll('button[data-target]').forEach(btn => {
    btn.addEventListener('click', () => {
      const targetId = btn.getAttribute('data-target');
      showSection(targetId);
      navMenu.classList.remove('active');
      navBtn.setAttribute('aria-expanded', false);
    });
  });

  // Show section function
  function showSection(id) {
    [shopSection, cartSection, reviewSection, meetupSection, adminDashboard].forEach(section => {
      if(section.id === id) section.hidden = false;
      else section.hidden = true;
    });
  }
  // Default show shop
  showSection('shopSection');

  // Price display update
  function updatePrice() {
    let quantity = 1; // default 1 for shop screen
    if(cart.length > 0) quantity = cart.reduce((acc, c) => acc + c.qty, 0);
    const baseTotal = PRICE_BASE * quantity;
    const taxTotal = TAX_PER_UNIT * quantity;
    const total = baseTotal + taxTotal;
    priceDisplay.value = `$${total.toFixed(2)} (Includes $${taxTotal} tax)`;
  }
  updatePrice();

  // Add to cart
  addToCartBtn.addEventListener('click', () => {
    // Check if item already in cart (only one item type supported)
    const existingItemIndex = cart.findIndex(item => item.brand === BRAND && item.flavor === FLAVOR);
    if(existingItemIndex >= 0) {
      cart[existingItemIndex].qty++;
    } else {
      cart.push({ brand: BRAND, flavor: FLAVOR, qty: 1, basePrice: PRICE_BASE });
    }
    updateCartUI();
    updatePrice();
    showSection('cartSection');
  });

  // Update cart UI
  function updateCartUI() {
    if(cart.length === 0) {
      cartList.innerHTML = '<li>Your cart is empty.</li>';
      return;
    }
    cartList.innerHTML = '';
    cart.forEach((item, idx) => {
      const li = document.createElement('li');
      li.setAttribute('role', 'listitem');
      li.innerHTML = `
        <div class="item-name">${item.brand} - ${item.flavor}</div>
        <div class="qty-controls" aria-label="Quantity controls for ${item.brand} ${item.flavor}">
          <button aria-label="Decrease quantity" data-idx="${idx}" class="decreaseQtyBtn">âˆ’</button>
          <div aria-live="polite" aria-atomic="true" style="min-width:28px; text-align:center;">${item.qty}</div>
          <button aria-label="Increase quantity" data-idx="${idx}" class="increaseQtyBtn">+</button>
        </div>
      `;
      cartList.appendChild(li);
    });

    // Attach quantity button listeners
    cartList.querySelectorAll('.decreaseQtyBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        const idx = Number(btn.dataset.idx);
        if(cart[idx].qty > 1) {
          cart[idx].qty--;
        } else {
          cart.splice(idx,1);
        }
        updateCartUI();
        updatePrice();
      });
    });
    cartList.querySelectorAll('.increaseQtyBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        const idx = Number(btn.dataset.idx);
        cart[idx].qty++;
        updateCartUI();
        updatePrice();
      });
    });
  }

  updateCartUI();

  // Place order
  placeOrderBtn.addEventListener('click', () => {
    const buyerName = buyerNameInput.value.trim();
    const meetupLocation = meetupLocationInput.value.trim();
    const scheduledDate = scheduledDateInput.value;

    if(cart.length === 0) {
      alert("Your cart is empty.");
      return;
    }
    if(!buyerName) {
      alert("Please enter your name.");
      return;
    }
    if(!meetupLocation) {
      alert("Please enter meetup location.");
      return;
    }

    // Create order object
    const order = {
      id: Date.now(),
      buyerName,
      meetupLocation,
      scheduledDate,
      items: JSON.parse(JSON.stringify(cart)),
      status: 'Pending',
      orderDate: new Date().toISOString(),
      orderPhoto: null
    };

    orders.push(order);
    localStorage.setItem('orders', JSON.stringify(orders));

    // Clear cart and inputs
    cart = [];
    updateCartUI();
    updatePrice();
    buyerNameInput.value = '';
    meetupLocationInput.value = '';
    scheduledDateInput.value = '';
    orderStatusContainer.hidden = true;

    // Show order placed notification
    showToast("Order placed successfully! We'll contact you.");

    // Show meetup requests updated
    renderMeetupRequests();

    // Show shop again
    showSection('shopSection');
  });

  // Toast helper
  const toast = document.getElementById('toast');
  let toastTimeout;
  function showToast(msg) {
    toast.textContent = msg;
    toast.classList.add('show');
    clearTimeout(toastTimeout);
    toastTimeout = setTimeout(() => {
      toast.classList.remove('show');
    }, 3500);
  }

  // Reviews star rating - keyboard & mouse
  let serviceRating = 0;
  const stars = [...serviceStarsContainer.querySelectorAll('.star')];
  stars.forEach((star, idx) => {
    star.addEventListener('click', () => {
      setRating(idx + 1);
    });
    star.addEventListener('keydown', e => {
      if(e.key === 'ArrowRight' || e.key === 'ArrowUp') {
        e.preventDefault();
        let next = Math.min(serviceRating + 1, 5);
        setRating(next);
        stars[next - 1].focus();
      } else if(e.key === 'ArrowLeft' || e.key === 'ArrowDown') {
        e.preventDefault();
        let prev = Math.max(serviceRating - 1, 1);
        setRating(prev);
        stars[prev - 1].focus();
      } else if(e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        setRating(idx + 1);
      }
    });
    star.addEventListener('mouseover', () => {
      highlightStars(idx + 1);
    });
    star.addEventListener('mouseout', () => {
      highlightStars(serviceRating);
    });
  });
  function setRating(val) {
    serviceRating = val;
    stars.forEach((star, i) => {
      star.classList.toggle('selected', i < serviceRating);
      star.setAttribute('aria-checked', i < serviceRating ? 'true' : 'false');
      star.tabIndex = i === serviceRating - 1 ? 0 : -1;
    });
  }
  function highlightStars(val) {
    stars.forEach((star,i) => {
      star.classList.toggle('hovered', i < val);
    });
  }
  setRating(0);

  // Submit review form
  reviewForm.addEventListener('submit', e => {
    e.preventDefault();
    const name = reviewerNameInput.value.trim();
    const reviewText = reviewTextInput.value.trim();
    if(name.length === 0 || reviewText.length === 0 || serviceRating === 0) {
      alert("Please fill your name, review and select rating.");
      return;
    }

    // Mask name to first letter and stars
    const maskedName = name[0].toUpperCase() + '...';

    reviews.push({
      id: Date.now(),
      name: maskedName,
      text: reviewText,
      rating: serviceRating,
      date: new Date().toISOString()
    });
    localStorage.setItem('reviews', JSON.stringify(reviews));

    reviewerNameInput.value = '';
    reviewTextInput.value = '';
    setRating(0);

    renderReviews();
    showToast("Thank you for your review!");
  });

  // Render reviews list
  function renderReviews() {
    if(reviews.length === 0) {
      reviewsList.innerHTML = '<p>No reviews yet.</p>';
      return;
    }
    reviewsList.innerHTML = '';
    reviews.forEach(r => {
      const div = document.createElement('div');
      div.className = 'review-card';
      div.setAttribute('role', 'listitem');
      div.innerHTML = `
        <div><strong>${r.name}</strong> â€” <small>${new Date(r.date).toLocaleDateString()}</small></div>
        <div aria-label="Rating: ${r.rating} out of 5 stars" role="img">${'â˜…'.repeat(r.rating)}${'â˜†'.repeat(5-r.rating)}</div>
        <p>${r.text}</p>
      `;
      reviewsList.appendChild(div);
    });
  }
  renderReviews();

  // Render meetup requests list
  function renderMeetupRequests() {
    if(orders.length === 0) {
      meetupRequestsDiv.innerHTML = '<p>No meetup requests yet.</p>';
      return;
    }
    meetupRequestsDiv.innerHTML = '';
    orders.forEach(order => {
      const div = document.createElement('div');
      div.className = 'meetup-request';
      div.setAttribute('role', 'listitem');
      div.innerHTML = `
        <p><strong>${order.buyerName}</strong> â€” Location: ${order.meetupLocation} â€” Date: ${order.scheduledDate || 'Not scheduled'}</p>
      `;
      meetupRequestsDiv.appendChild(div);
    });
  }
  renderMeetupRequests();

  // Submit meetup feedback
  meetupFeedbackForm.addEventListener('submit', e => {
    e.preventDefault();
    const name = meetupNameInput.value.trim();
    const response = meetupResponseInput.value;

    if(!name || !response) {
      alert("Please enter your name and select a response.");
      return;
    }
    meetupFeedbacks.push({
      id: Date.now(),
      name,
      response,
      date: new Date().toISOString()
    });
    localStorage.setItem('meetupFeedbacks', JSON.stringify(meetupFeedbacks));

    meetupNameInput.value = '';
    meetupResponseInput.value = '';

    showToast("Thank you for your feedback!");
  });

  // Admin panel login
  adminPanelBtn.addEventListener('click', () => {
    loginModal.classList.remove('hidden');
    loginError.style.display = 'none';
  });

  loginBtn.addEventListener('click', () => {
    const username = adminUsernameInput.value.trim();
    const password = adminPasswordInput.value.trim();

    if(username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
      loggedIn = true;
      loginModal.classList.add('hidden');
      adminUsernameInput.value = '';
      adminPasswordInput.value = '';
      showSection('adminDashboard');
      renderAdminOrders();
      renderAdminReviews();
      renderProfit();
      showToast("Logged in as Admin.");
    } else {
      loginError.style.display = 'block';
    }
  });

  // Admin logout
  logoutAdminBtn.addEventListener('click', () => {
    loggedIn = false;
    showSection('shopSection');
    showToast("Logged out.");
  });

  // Render admin orders
  function renderAdminOrders() {
    if(orders.length === 0) {
      adminOrdersList.innerHTML = '<p>No orders yet.</p>';
      return;
    }
    adminOrdersList.innerHTML = '';
    orders.forEach(order => {
      const div = document.createElement('div');
      div.className = 'admin-order-card';
      div.innerHTML = `
        <p><strong>Order #${order.id}</strong></p>
        <p>Buyer: ${order.buyerName}</p>
        <p>Location: ${order.meetupLocation}</p>
        <p>Date: ${order.scheduledDate || 'Not scheduled'}</p>
        <p>Status: ${order.status}</p>
        <button data-id="${order.id}" class="fulfillOrderBtn">Mark as Fulfilled</button>
      `;
      adminOrdersList.appendChild(div);
    });

    // Attach fulfill buttons
    adminOrdersList.querySelectorAll('.fulfillOrderBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = Number(btn.dataset.id);
        const order = orders.find(o => o.id === id);
        if(order) {
          order.status = 'Fulfilled';
          localStorage.setItem('orders', JSON.stringify(orders));
          renderAdminOrders();
          renderProfit();
          showToast(`Order #${id} marked as fulfilled.`);
        }
      });
    });
  }

  // Render admin reviews
  function renderAdminReviews() {
    if(reviews.length === 0) {
      adminReviewsList.innerHTML = '<p>No reviews yet.</p>';
      return;
    }
    adminReviewsList.innerHTML = '';
    reviews.forEach(r => {
      const div = document.createElement('div');
      div.className = 'admin-review-card';
      div.innerHTML = `
        <p><strong>${r.name}</strong></p>
        <p>Rating: ${r.rating} / 5</p>
        <p>${r.text}</p>
        <button data-id="${r.id}" class="deleteReviewBtn">Delete Review</button>
      `;
      adminReviewsList.appendChild(div);
    });

    // Attach delete review buttons
    adminReviewsList.querySelectorAll('.deleteReviewBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = Number(btn.dataset.id);
        reviews = reviews.filter(r => r.id !== id);
        localStorage.setItem('reviews', JSON.stringify(reviews));
        renderAdminReviews();
        renderReviews();
        showToast('Review deleted.');
      });
    });
  }

  // Calculate and render profit
  function renderProfit() {
    const fulfilledOrders = orders.filter(o => o.status === 'Fulfilled');
    let profit = 0;
    fulfilledOrders.forEach(order => {
      order.items.forEach(item => {
        profit += (item.basePrice + TAX_PER_UNIT) * item.qty;
      });
    });
    profitDisplay.textContent = `$${profit.toFixed(2)}`;
  }

})();
</script>

<style>
  /* Basic resets */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f9f9f9;
    color: #222;
  }
  header {
    background: #004080;
    color: white;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  header h1 {
    margin: 0;
    font-size: 1.5rem;
  }
  nav button {
    background: transparent;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 1rem;
  }
  nav button:focus {
    outline: 2px solid #fff;
  }
  #navMenu {
    display: none;
    flex-direction: column;
    background: #0066cc;
    position: absolute;
    top: 3.5rem;
    left: 0;
    width: 100%;
  }
  #navMenu.active {
    display: flex;
  }
  #navMenu button {
    padding: 0.8rem 1rem;
    border-bottom: 1px solid #0055aa;
    text-align: left;
  }
  main {
    padding: 1rem;
    max-width: 900px;
    margin: auto;
  }
  .card {
    background: white;
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: 4px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  button {
    background: #004080;
    color: white;
    border: none;
    padding: 0.6rem 1rem;
    border-radius: 4px;
    cursor: pointer;
  }
  button:hover, button:focus {
    background: #003366;
  }
  #priceDisplay {
    width: 100%;
    padding: 0.5rem;
    margin-top: 0.5rem;
    font-weight: 600;
    font-size: 1.2rem;
  }
  #cartList, #reviewsList, #adminOrdersList, #adminReviewsList, #meetupRequests {
    max-height: 300px;
    overflow-y: auto;
  }
  .qty-controls {
    display: inline-flex;
    align-items: center;
  }
  .qty-controls button {
    width: 28px;
    height: 28px;
    font-size: 1.2rem;
    line-height: 1;
    padding: 0;
    margin: 0 4px;
  }
  .star {
    font-size: 1.6rem;
    cursor: pointer;
    color: #ccc;
    user-select: none;
  }
  .star.selected, .star.hovered {
    color: gold;
  }
  .review-card, .admin-order-card, .admin-review-card, .meetup-request {
    border-bottom: 1px solid #ddd;
    padding: 8px 0;
  }
  #loginModal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .modal-content {
    background: white;
    padding: 1.5rem;
    border-radius: 6px;
    max-width: 320px;
    width: 100%;
    box-shadow: 0 0 10px rgba(0,0,0,0.25);
    position: relative;
  }
  #loginError {
    color: red;
    margin-top: 0.5rem;
    display: none;
  }
  #toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #004080;
    color: white;
    padding: 0.8rem 1.2rem;
    border-radius: 4px;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }
  #toast.show {
    opacity: 1;
    pointer-events: auto;
  }
</style>
